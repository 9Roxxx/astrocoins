{% extends "core/base.html" %}

{% block title %}{{ school.name }} - AstroCoins{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∫–æ–ª–µ -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-school me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∫–æ–ª–µ
                    </h5>
                </div>
                <div class="card-body">
                    <h6>{{ school.name }}</h6>
                    <p class="mb-2"><strong>–ì–æ—Ä–æ–¥:</strong> {{ school.city.name }}</p>
                    <p class="mb-2"><strong>–î–∏—Ä–µ–∫—Ç–æ—Ä:</strong> {{ school.director }}</p>
                    <p class="mb-2"><strong>–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å:</strong> {{ school.representative }}</p>
                    
                    <hr>
                    
                    <h6>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h6>
                    <p class="mb-1"><i class="fas fa-phone me-2"></i>{{ school.phone }}</p>
                    {% if school.email %}
                    <p class="mb-1"><i class="fas fa-envelope me-2"></i>{{ school.email }}</p>
                    {% endif %}
                    {% if school.website %}
                    <p class="mb-1"><i class="fas fa-globe me-2"></i><a href="{{ school.website }}" target="_blank">{{ school.website }}</a></p>
                    {% endif %}
                    <p class="mb-1"><i class="fas fa-map-marker-alt me-2"></i>{{ school.address }}</p>
                    
                    <hr>
                    
                    <h6>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="border rounded p-2">
                                <h5 class="text-success">{{ active_courses_count }}</h5>
                                <small>–ê–∫—Ç–∏–≤–Ω—ã–µ –∫—É—Ä—Å—ã</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded p-2">
                                <h5 class="text-warning">{{ inactive_courses_count }}</h5>
                                <small>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫—É—Ä—Å—ã</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded p-2">
                                <h5 class="text-info">{{ groups_count }}</h5>
                                <small>–í—Å–µ–≥–æ –≥—Ä—É–ø–ø</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <a href="{% url 'school_management' %}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-arrow-left me-1"></i>–ö —Å–ø–∏—Å–∫—É —à–∫–æ–ª
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ö—É—Ä—Å—ã —à–∫–æ–ª—ã -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-book me-2"></i>–ö—É—Ä—Å—ã —à–∫–æ–ª—ã
                    </h5>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCourseModal">
                        <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å
                    </button>
                </div>
                <div class="card-body">
                    <!-- –ü–æ–∏—Å–∫ –∫—É—Ä—Å–æ–≤ -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <form method="GET" class="d-flex">
                                <input type="text" name="search" class="form-control" 
                                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é –∫—É—Ä—Å–∞..."
                                       value="{{ search_query }}">
                                <button type="submit" class="btn btn-outline-primary ms-2">
                                    <i class="fas fa-search"></i>
                                </button>
                                {% if search_query %}
                                <a href="{% url 'school_detail' school.id %}" class="btn btn-outline-secondary ms-2">
                                    <i class="fas fa-times"></i>
                                </a>
                                {% endif %}
                            </form>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤ -->
                    <div class="row">
                        {% for course in courses %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 {% if not course.is_active %}border-warning{% endif %}">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="card-title mb-0">
                                        {% if course.is_active %}
                                        <span class="badge bg-success me-2">üü¢</span>
                                        {% else %}
                                        <span class="badge bg-warning me-2">üî¥</span>
                                        {% endif %}
                                        {{ course.name }}
                                    </h6>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <button class="dropdown-item" onclick="editCourse({{ course.id }})" 
                                                        data-bs-toggle="modal" data-bs-target="#editCourseModal">
                                                    <i class="fas fa-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                                </button>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li>
                                                <button class="dropdown-item text-danger" 
                                                        onclick="deleteCourse({{ course.id }}, '{{ course.name }}')"
                                                        data-bs-toggle="modal" data-bs-target="#deleteCourseModal">
                                                    <i class="fas fa-trash me-2"></i>–£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-body">
                                    {% if course.description %}
                                    <p class="card-text">{{ course.description|truncatechars:100 }}</p>
                                    {% endif %}
                                    <div class="row">
                                        <div class="col-6">
                                            <small class="text-muted">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</small>
                                            <br><strong>{{ course.duration_hours }} —á.</strong>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">–ì—Ä—É–ø–ø:</small>
                                            <br><strong>{{ course.groups_count }}</strong>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <small class="text-muted">–°–æ–∑–¥–∞–Ω: {{ course.created_at|date:"d.m.Y" }}</small>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12">
                            <div class="text-center py-4">
                                <i class="fas fa-book fa-3x text-muted mb-3"></i>
                                <p class="text-muted">
                                    {% if search_query %}
                                        –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –∫—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                                    {% else %}
                                        –í —ç—Ç–æ–π —à–∫–æ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤
                                    {% endif %}
                                </p>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCourseModal">
                                    <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞ -->
<div class="modal fade" id="createCourseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{% url 'create_course' school.id %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="courseName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="courseName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="courseDescription" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="courseDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="courseDuration" class="form-label">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
                        <input type="number" class="form-control" id="courseDuration" name="duration_hours" 
                               value="0" min="0">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="courseActive" name="is_active" checked>
                        <label class="form-check-label" for="courseActive">
                            –ê–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–∞ -->
<div class="modal fade" id="editCourseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" id="editCourseForm">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="school" value="{{ school.id }}">
                    <div class="mb-3">
                        <label for="editCourseName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editCourseName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editCourseDescription" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="editCourseDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editCourseDuration" class="form-label">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
                        <input type="number" class="form-control" id="editCourseDuration" name="duration_hours" min="0">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="editCourseActive" name="is_active">
                        <label class="form-check-label" for="editCourseActive">
                            –ê–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞ -->
<div class="modal fade" id="deleteCourseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" id="deleteCourseForm">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title text-danger">–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å <strong id="deleteCourseName"></strong>?
                    </div>
                    <p class="text-muted">–í—Å–µ –≥—Ä—É–ø–ø—ã —ç—Ç–æ–≥–æ –∫—É—Ä—Å–∞ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–∞
function editCourse(courseId) {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–∞
    // –ü–æ–∫–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º action —Ñ–æ—Ä–º—ã
    document.getElementById('editCourseForm').action = `/course/${courseId}/edit/`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞
function deleteCourse(courseId, courseName) {
    document.getElementById('deleteCourseName').textContent = courseName;
    document.getElementById('deleteCourseForm').action = `/course/${courseId}/delete/`;
}
</script>
{% endblock %}